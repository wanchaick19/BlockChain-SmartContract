<!DOCTYPE html>
<html lang="en">
<head>
    <title>Student Name in Blockchain Class</title>
    <link rel="stylesheet" type="text/css" href="main.css">
    <!-- <script src="./node_modules/web3/dist/web3.min.js">
    </script> -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.4/dist/web3.min.js"></script>
</head>
<body>



    <!-- New Booking Section -->
    <div class="hero">
        <h1>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà ‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏°‡∏ó‡∏™</h1>
        <p>Discover amazing deals and services designed just for you! Lorem ipsum dolor sit amet, consectetur adipisicing elit. Suscipit sit dolores ab incidunt, labore quidem mollitia maiores! Optio aliquid, dicta consequatur, repellendus at distinctio et illo quisquam excepturi cum fugiat ratione omnis amet eligendi? Consectetur, sunt libero! Eum, labore tempore, ipsa consectetur earum minus ad sunt optio nobis rerum doloribus!</p>
        <button>Explore Now</button>
    </div>

    <div class="services">
        <div class="service-card">
            <img src="https://scontent.fbkk3-4.fna.fbcdn.net/v/t39.30808-6/472845287_122202128258036746_910605395154881804_n.jpg?_nc_cat=108&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeHIPYFbUrSV_MIAVaNlAIFPMGR4hDYmpA4wZHiENiakDqydRE6KYwHTpPWTJwYI0C7iJPakz-9BybaFBoroRzOZ&_nc_ohc=gdYE0PlM5VcQ7kNvgE2NiBc&_nc_zt=23&_nc_ht=scontent.fbkk3-4.fna&_nc_gid=AU17o9QtDjxqNgJ1Zgcbcvd&oh=00_AYAKyk80llaAS3qFaCCblSXSX0uhqppPLz1YegDFOQ4yIQ&oe=67911996" alt="Service 1">
            <h3>‡∏ß‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h3>
            <p>Professional and reliable services for your business needs.</p>
            <button>Learn More</button>
        </div>
        <div class="service-card">
            <img src="https://scontent.fbkk3-4.fna.fbcdn.net/v/t39.30808-6/465063836_1084605463677046_5831427156936243828_n.jpg?_nc_cat=111&ccb=1-7&_nc_sid=127cfc&_nc_eui2=AeHC-4W0LaWD4j-GzrAZi2xPS555U22MpPRLnnlTbYyk9IrJNYUs_BGsZ6hD61WLEdUqke4UK4iAe_WSXzIEc44d&_nc_ohc=8VwM97ExeFcQ7kNvgEmSUpi&_nc_zt=23&_nc_ht=scontent.fbkk3-4.fna&_nc_gid=AH6stz0apT9TdzU_HOrl4n-&oh=00_AYA39dCRO6r-a6CRiSkJvehEVYryi2Z64liOjeiYVqOgOw&oe=67912CE3" alt="Service 2">
            <h3>‡∏ô‡πâ‡∏≥‡∏î‡∏∑‡πà‡∏°‡∏ï‡∏£‡∏≤ ‡∏°‡∏ó‡∏™</h3>
            <p>High-quality products with affordable prices just for you.</p>
            <button>Learn More</button>
        </div>
        <div class="service-card">
            <img src="https://scontent.fbkk3-3.fna.fbcdn.net/v/t39.30808-6/471356783_122199307418036746_4775593858362262009_n.jpg?_nc_cat=103&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeHznw5FzTgR8VwWmXsuMdMh6CM-H4YHYEfoIz4fhgdgR_-fa2NJTMnYRTLEzAk5Vd_s3q5YNGIjcd53k56KevA1&_nc_ohc=Pzeygc9ob6UQ7kNvgHI7mzj&_nc_zt=23&_nc_ht=scontent.fbkk3-3.fna&_nc_gid=AOcr7GC3mj7_MbJGUdSppPD&oh=00_AYC2s3Ka6Vvok3x9a7lnQoyQ-jFbNUOxLYwaO0NKIgZ62A&oe=67910F03" alt="Service 3">
            <h3>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏´‡∏¢‡∏∏‡∏î‡∏ß‡∏±‡∏ô‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà</h3>
            <p>Get the best support and guidance from our experts.</p>
            <button>Learn More</button>
        </div>
    </div>



    <h2 style="text-align: center;">Shop Booking</h2>
    <h4 style="text-align: center;">Booking Status : <span id="status">Not Ready!</span></h4>
    <div id="shop-booking">
        <div class="shop">
            <img width="500" src="https://scontent.fbkk3-3.fna.fbcdn.net/v/t39.30808-6/471162408_122199209228036746_4215557970458506955_n.jpg?_nc_cat=100&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeFdOzye2kwBnfRddqiGBGIfDatz8EEkE-sNq3PwQSQT66CjveyBuNTBtcCddk0sSKyN4Pc4am_AGZVPMSaJCNYo&_nc_ohc=hcFngOqxkOUQ7kNvgErlczI&_nc_zt=23&_nc_ht=scontent.fbkk3-3.fna&_nc_gid=AZi40Q3BDK9GkVukZUWTdmP&oh=00_AYBKVGFLYp6JQi1zWyMZXPGXwZ5yPZs-orjRppYJACmpZg&oe=679111B9" alt="Shop 1" class="shop-image">
            <p>SUT-B1</p>
            <input type="text" id="Store1" placeholder="Enter Shop Name">
            <button class="btn-book" id="btnStore1">Book Shop 1</button>
        </div>
        <div class="shop">
            <img width="500" src="https://scontent.fbkk3-3.fna.fbcdn.net/v/t39.30808-6/471162408_122199209228036746_4215557970458506955_n.jpg?_nc_cat=100&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeFdOzye2kwBnfRddqiGBGIfDatz8EEkE-sNq3PwQSQT66CjveyBuNTBtcCddk0sSKyN4Pc4am_AGZVPMSaJCNYo&_nc_ohc=hcFngOqxkOUQ7kNvgErlczI&_nc_zt=23&_nc_ht=scontent.fbkk3-3.fna&_nc_gid=AZi40Q3BDK9GkVukZUWTdmP&oh=00_AYBKVGFLYp6JQi1zWyMZXPGXwZ5yPZs-orjRppYJACmpZg&oe=679111B9" alt="Shop 2" class="shop-image">
            <p>SUT-B2</p>
            <input type="text" id="Store2" placeholder="Enter Shop Name">
            <button class="btn-book">Book Shop 2</button>
        </div>
        <div class="shop">
            <img width="500" src="https://scontent.fbkk3-3.fna.fbcdn.net/v/t39.30808-6/471162408_122199209228036746_4215557970458506955_n.jpg?_nc_cat=100&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeFdOzye2kwBnfRddqiGBGIfDatz8EEkE-sNq3PwQSQT66CjveyBuNTBtcCddk0sSKyN4Pc4am_AGZVPMSaJCNYo&_nc_ohc=hcFngOqxkOUQ7kNvgErlczI&_nc_zt=23&_nc_ht=scontent.fbkk3-3.fna&_nc_gid=AZi40Q3BDK9GkVukZUWTdmP&oh=00_AYBKVGFLYp6JQi1zWyMZXPGXwZ5yPZs-orjRppYJACmpZg&oe=679111B9" alt="Shop 3" class="shop-image">
            <p>SUT-B3</p>
            <input type="text" id="Store3" placeholder="Enter Shop Name">
            <button class="btn-book">Book Shop 3</button>
        </div>
        <div class="shop">
            <img width="500" src="https://scontent.fbkk3-3.fna.fbcdn.net/v/t39.30808-6/471162408_122199209228036746_4215557970458506955_n.jpg?_nc_cat=100&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeFdOzye2kwBnfRddqiGBGIfDatz8EEkE-sNq3PwQSQT66CjveyBuNTBtcCddk0sSKyN4Pc4am_AGZVPMSaJCNYo&_nc_ohc=hcFngOqxkOUQ7kNvgErlczI&_nc_zt=23&_nc_ht=scontent.fbkk3-3.fna&_nc_gid=AZi40Q3BDK9GkVukZUWTdmP&oh=00_AYBKVGFLYp6JQi1zWyMZXPGXwZ5yPZs-orjRppYJACmpZg&oe=679111B9" alt="Shop 4" class="shop-image">
            <p>SUT-B4</p>
            <input type="text" id="Store4" placeholder="Enter Shop Name">
            <button class="btn-book">Book Shop 4</button>
        </div>
    </div>

    <div class="Check">
        <h2>üîç Check Booked Store</h2>
        <p>Enter the store name below to check its booking status:</p>
        <div class="input-container">
            <input id="inputCheckStore" type="text" placeholder="Enter store name...">
            <button id="CheckStore">Check</button>
        </div>
        <h3 id="result">Result will be shown here</h3>
    </div>
    








    <!-- ‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏à‡∏≤‡∏£ -->
    <!-- <div class="container">
        <h1>Student Name in Blockchain Class</h1>
        <label class="col-lg-2 control-label">
        Name Registration</label>
        <input id="document1" type="text">
        <button id="btnRegistration">Registration</button>
                
        <label class="col-lg-2 control-label">
        Check Student Name</label>
        <input id="document2" type="text">
        <button id="btnCheck">Check</button> 
            
        <label class="col-lg-2 control-label">Status</label>
        <h2 id="result"></h2>
        Status: <span id="status">Loading...</span>
    </div> -->


    <!-- script -->
    <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"></script>
    <script>
        
        // ===Connecting to MetaMask===
        function loadWeb3() {
            if (window.ethereum) {
                // To get web3(.js) object

                web3 = new Web3(window.ethereum)
                
                // To request user's account from Metamask
                ethereum
                    .request({ method: 'eth_requestAccounts' })           
                    .then(handleAccountsChanged)
                    .catch((err) => {
                        if (err.code === 4001) {
                            // If this happens, the user rejected the connection request.
                            console.log('Please connect to MetaMask.');
                        } else {
                            console.error(err);
                        }
                    });
            }
        }
        
        // ===Handle user accounts and accountsChanged===
        let currentAccount = null;
        
        // Note that this event is emitted on page load.
        // If the array of accounts is non-empty, you're already connected.
        window.ethereum.on('accountsChanged', handleAccountsChanged);

        // For now, 'eth_accounts' will continue to always return an array
        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                // MetaMask is locked or the user has not connected any accounts
                console.log('Please connect to MetaMask.');
            } else if (accounts[0] !== currentAccount) {
                currentAccount = accounts[0];
            }
        }

        let abi = [
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": false,
                        "internalType": "address",
                        "name": "from",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "string",
                        "name": "shopName",
                        "type": "string"
                    },
                    {
                        "indexed": false,
                        "internalType": "string",
                        "name": "reason",
                        "type": "string"
                    }
                ],
                "name": "BookingError",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": false,
                        "internalType": "address",
                        "name": "from",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "string",
                        "name": "shopName",
                        "type": "string"
                    },
                    {
                        "indexed": false,
                        "internalType": "bytes32",
                        "name": "hash",
                        "type": "bytes32"
                    }
                ],
                "name": "SpaceBooked",
                "type": "event"
            },
            {
                "inputs": [
                    {
                        "internalType": "string",
                        "name": "shopName",
                        "type": "string"
                    }
                ],
                "name": "bookSpace",
                "outputs": [],
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "string",
                        "name": "shopName",
                        "type": "string"
                    }
                ],
                "name": "checkBooking",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ]
        
        async function loadContract() {
            return await new web3.eth.Contract(abi, '0xA47C9ceAB6fB4913Ad30Ad0f62fC27fA8D3F7bAf');
        }

        async function load() {
            await loadWeb3();
            web3.contract = await loadContract();
            updateStatus('Ready!');
        }
        
        function updateStatus(status) {
            const statusEl = document.getElementById('status');
            statusEl.innerHTML = status;
            console.log(status);
        }




        $("#btnStore1").click(function() {
            console.log(currentAccount)
            web3.contract.methods.bookSpace($("#Store1").val())
                .send({from: currentAccount
                ,value: web3.utils.toWei("0.00001","ether")}
                ,function(error,result) {
                $("#result").html(result);
            });
            web3.contract.once("SpaceBooked", {}, function(error, event){
                if (!error) {
                    console.log(event);
                    $("#result").html("Name: " + event.returnValues.shopName + "<br/>=> Hashed as: " + event.returnValues.hash);
                }
            });
            web3.contract.once('BookingError', {}, function(error, event){
                if(!error) {
                    console.log(event);
                    $("#result").html("Error: " + event.returnValues.shopName + "<br/>Reason " + event.returnValues.reason);
                }
            });
            
        });

        $("#CheckStore").click(function() {
            web3.contract.methods.checkBooking($("#inputCheckStore").val()).call(function(error, result){
                if(!error) {
                    $("#result").html(result.toString());
                } else
                    console.error(error);
            });     
        });

        load();
    </script>
</body>
</html>